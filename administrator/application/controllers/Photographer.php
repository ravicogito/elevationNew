<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Photographer extends CI_Controller {	public function __construct(){			parent::__construct();			if($this->session->userdata('admin_user_id') =='') {				redirect(base_url());			}				$this->load->model('photographermodel');					$this->load->model('resortmodel');			$this->load->model('Customermodel');	}		public function index(){		$data['photographer_list']	= $this->photographermodel->index();				$this->load->view("common/header");		$this->load->view("common/sidebar");		$this->load->view("theme-v1/photographer_list", $data);		$this->load->view("common/footer-inner");	}	public function addPhotographer(){			$resort_list		= $this->resortmodel->index();	if(!empty($resort_list)){			$data['resort_list']		= $resort_list;		}			if(!empty($_POST)){			$email 			= $this->input->post('photographer_email');			$mobile 		= $this->input->post('photographer_mobile');			$photographer_userName		= $this->input->post('photographer_userName');			$unique_email	= $this->photographermodel->checkUniqueEmail($email);			$unique_mobile	= $this->photographermodel->checkUniquemobile($mobile);			$unique_photographer_userName	= $this->photographermodel->checkUniqueUsername($photographer_userName);						if($unique_email !='0'){				$this->session->set_flashdata("pass_inc","This email is already added");				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/add_photographer',$data);				$this->load->view("common/footer-inner");			}			else if($unique_mobile !='0'){				$this->session->set_flashdata("pass_inc","This mobile is already added");				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/add_photographer',$data);				$this->load->view("common/footer-inner");							}						else if($unique_photographer_userName !='0'){				$this->session->set_flashdata("pass_inc","This User Name is already added");				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/add_photographer',$data);				$this->load->view("common/footer-inner");							}			else{												//$photographer_mobile		= $this->input->post('photographer_mobile');									$password_last_fourdigit = substr($mobile, -4);				$data =  array(									'photographer_name'			=>$this->input->post('photographer_name'),																		'photographer_email'		=>$this->input->post('photographer_email'),																		'photographer_mobile'		=>$mobile,									'photographer_description'	=>$this->input->post('photographer_editor1'),																		'photographer_status'		=>'1',																		'member_on'					=>date('Y-m-d')								);				$mess = $this->photographermodel->insertData($data,'el_photographer');												if($mess){										$data_user =  array(									'photographer_id'	=>$mess,																		'name'				=>$this->input->post('photographer_name'),																		'email'				=>$this->input->post('photographer_email'),																		'username'			=>$photographer_userName,									'password'			=>$password_last_fourdigit,																		'role_id'			=>'2',																		'user_status'		=>1								);												$this->photographermodel->insertData($data_user,'el_admin');										$this->session->set_flashdata("sucessPageMessage","Photographer Added Successfully!");					redirect(base_url()."Photographer");				}			}		}		else{				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/add_photographer',$data);				$this->load->view("common/footer-inner");			}	}		public function editPhotographer($id){		//echo $id;		$resort_list		= $this->resortmodel->index();			if(!empty($resort_list)){				$data['resort_list']		= $resort_list;			}		$data['photographer_data'] = $this->photographermodel->photographerEdit($id);		$this->load->view("common/header");		$this->load->view("common/sidebar");		$this->load->view("theme-v1/edit_photographer", $data);		$this->load->view("common/footer-inner");	}			public function accountsetting(){				$user_id = $this->session->userdata('admin_user_id');				$edit_user_name   		= $this->input->post('user_name');		$user_email		 		= $this->input->post('user_email');		$current_password 		= $this->input->post('current_password');		$enter_new_password 	= $this->input->post('enter_new_password');		$reenter_new_password   = $this->input->post('reenter_new_password');		//echo $user_id;		//die;		$data['user_edit']		= $this->photographermodel->editUserByid($user_id);				if(!empty($current_password)) {			$match_current_password		= $this->photographermodel->checkCurrentPassword($user_id,$current_password);			if(!empty($match_current_password))			{				if($enter_new_password == $reenter_new_password)				{					$password = $enter_new_password;									}				else{					$this->session->set_flashdata("current_password_missmatch","Your New Password Missmatch!");							redirect(base_url()."Photographer/accountsetting");					}							}			/* else if(!empty($match_current_password) && ($current_password == "")){					$this->session->set_flashdata("current_password_empty","Please Enter Your Current Password!");					redirect(base_url()."Photographer/accountsetting");			} */			else{					$this->session->set_flashdata("current_password_missmatch","Your Old Password Missmatch!");					redirect(base_url()."Photographer/accountsetting");			}		}				if(!empty($password))		{			$password = $password;		}		else{			$password = $data['user_edit']['password'];		}		/* echo"<pre>";		print_r($match_current_password);		die; */						if($_POST){							$data =  array(								'name'			=>$edit_user_name,																'email'			=>$user_email,																'password'		=>$password							);				$mess = $this->photographermodel->editUserdata('el_admin',$data,$user_id);												if($mess){					$this->session->set_flashdata("sucessPageMessage","Your Profile Edit Successfully!");					redirect(base_url()."Photographer/accountsetting");				}		}		$this->load->view("common/header");		$this->load->view("common/sidebar");		$this->load->view("theme-v1/edit_user_account", $data);		$this->load->view("common/footer-inner");	}		public function updatePhotographer($photographer_id){		if(!empty($_POST)){			$email 			= $this->input->post('photographer_email');			$mobile 		= $this->input->post('photographer_mobile');			$unique_email	= $this->photographermodel->checkUniqueEmailInEdit($email,$photographer_id);			$unique_mobile	= $this->photographermodel->checkUniquemobileInEdit($mobile,$photographer_id);			if($unique_email !='0'){				$this->session->set_flashdata("pass_inc","This email is already added");				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/edit_photographer'.$photographer_id.'/');				$this->load->view("common/footer-inner");			}			else if($unique_mobile !='0'){				$this->session->set_flashdata("pass_inc","This mobile is already added");				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/edit_photographer'.$photographer_id.'/');				$this->load->view("common/footer-inner");							}			else{			$resort_id		= $this->input->post('resort_id');						$data =  array(							'photographer_name'			=>$this->input->post('photographer_name'),														'photographer_email'		=>$this->input->post('photographer_email'),														'photographer_mobile'		=>$this->input->post('photographer_mobile'),							'photographer_description'	=>$this->input->post('photographer_editor1'),														'photographer_status'		=>'1'											);					$mess = $this->photographermodel->updatePhotographerbyId($photographer_id, $data , $resort_id);						if($mess==1){							$this->session->set_flashdata("sucessPageMessage","Photographer's information updated Successfully!");							redirect(base_url()."Photographer");						} 			}		} else{				$this->load->view("common/header");				$this->load->view("common/sidebar");				$this->load->view('theme-v1/edit_photographer'.$photographer_id.'/');				$this->load->view("common/footer-inner");			}	}		public function deletePhotographer($id){		$this->photographermodel->deletePhotographerbyId($id);				$condition_customer_photographer_relation = "photographer_id = '$id'";		$checkon_photographer_relations = $this->Customermodel->isRecordExist('el_media_customer_photographer_relation',$condition_customer_photographer_relation);				if(!empty($checkon_photographer_relations)){						foreach($checkon_photographer_relations as $checkon_photographer_relation)			{				$data 		=  array('rel_status'=>'0');				$condArr    =  array("media_rel_id" => $checkon_photographer_relation['media_rel_id']);				$update_rel_status = $this->Customermodel->deleteAssigneventCustomerId($data,'el_media_customer_photographer_relation',$condArr);			}					}				$admin_photographer_relation	= "photographer_id = '$id'";		$admin_relations  				= $this->Customermodel->isRecordExist('el_admin',$admin_photographer_relation);				if(!empty($admin_relations)){						foreach($admin_relations as $admin_relation)			{				$data 		=  array('user_status'=>'0');				$condArr    =  array("user_id" => $admin_relation['user_id']);				$update_rel_status = $this->Customermodel->deleteAssigneventCustomerId($data,'el_admin',$condArr);			}					}		$this->session->set_flashdata("sucessPageMessage","Photograph Deleted Successfully!");				redirect(base_url()."Photographer/");	}}